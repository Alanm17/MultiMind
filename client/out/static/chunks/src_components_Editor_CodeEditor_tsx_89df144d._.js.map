{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/aziz/Downloads/same-dev-platform%203/client/src/components/Editor/CodeEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Spinner } from \"@/components/ui/spinner\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useProjectStore } from \"@/store/useProjectStore\";\nimport Editor, { loader } from \"@monaco-editor/react\";\nimport { Copy, MoreHorizontal, Save, X } from \"lucide-react\";\nimport dynamic from \"next/dynamic\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { WebsocketProvider } from \"y-websocket\";\nimport * as Y from \"yjs\";\nimport { toast } from \"sonner\";\n\n// Dynamically import Monaco Editor to avoid SSR issues\nconst MonacoEditor = dynamic(() => import(\"@monaco-editor/react\"), {\n  ssr: false,\n  loading: () => (\n    <div className=\"h-full flex items-center justify-center\">\n      <Spinner size={32} />\n    </div>\n  ),\n});\n\nloader.config({\n  paths: { vs: \"https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs\" },\n});\n\nexport function CodeEditor() {\n  const {\n    openTabs,\n    activeTabId,\n    setActiveTab,\n    closeTab,\n    updateTabContent,\n    theme,\n  } = useProjectStore();\n\n  // Monaco CDN loader doesn't provide types, so use 'any' for compatibility\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const editorRef = useRef<any>(null);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const monacoRef = useRef<any>(null);\n  const ydocRef = useRef<Y.Doc | null>(null);\n  const providerRef = useRef<WebsocketProvider | null>(null);\n\n  const activeTab = openTabs.find((tab) => tab.id === activeTabId);\n\n  // Setup Yjs binding when activeTab changes\n  useEffect(() => {\n    if (!activeTab) return;\n    // Clean up previous Yjs doc/provider/binding\n    if (providerRef.current) providerRef.current.destroy();\n    if (ydocRef.current) ydocRef.current.destroy();\n    ydocRef.current = new Y.Doc();\n    // Use file path as room name\n    const roomName = `file-${activeTab.path}`;\n    providerRef.current = new WebsocketProvider(\n      \"ws://localhost:1234\",\n      roomName,\n      ydocRef.current\n    );\n    const yText = ydocRef.current.getText(\"monaco\");\n    // If the file is new, set its content\n    if (yText.length === 0 && activeTab.content) {\n      yText.insert(0, activeTab.content);\n    }\n    // Setup Monaco binding when editor is ready\n    if (editorRef.current && monacoRef.current) {\n      // biome-ignore lint/suspicious/noExplicitAny: Required for Monaco CDN loader compatibility\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const model = (editorRef.current as any).getModel(); // TODO: Use Monaco types if possible with CDN loader\n      if (model) {\n        // TODO: Implement manual Yjs <-> Monaco sync here (see Yjs docs for collaborative text binding)\n      }\n    }\n    // Cleanup on unmount or tab change\n    return () => {\n      if (providerRef.current) providerRef.current.destroy();\n      if (ydocRef.current) ydocRef.current.destroy();\n    };\n  }, [activeTab, activeTab?.path, activeTab?.content]);\n\n  // Keyboard shortcut for save (Ctrl+S/Cmd+S)\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === \"s\") {\n        e.preventDefault();\n        if (activeTab && activeTab.isDirty) {\n          handleSave();\n        }\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [activeTab]);\n\n  // Save handler\n  const handleSave = () => {\n    if (activeTabId && activeTab?.isDirty) {\n      // Simulate save (replace with real save logic if needed)\n      updateTabContent(activeTabId, activeTab.content);\n      toast.success(`Saved ${activeTab.name}`);\n    }\n  };\n\n  // Copy handler\n  const handleCopy = async () => {\n    if (activeTab?.content) {\n      await navigator.clipboard.writeText(activeTab.content);\n      toast.success(\"Copied to clipboard\");\n    }\n  };\n\n  const handleEditorDidMount = (editor: unknown, monacoInstance: unknown) => {\n    editorRef.current = editor;\n    monacoRef.current = monacoInstance;\n  };\n\n  const handleEditorChange = (value: string | undefined) => {\n    if (activeTabId && value !== undefined) {\n      updateTabContent(activeTabId, value);\n    }\n  };\n\n  // Middle-click to close tab\n  const handleTabMouseDown = (\n    tabId: string,\n    e: React.MouseEvent<HTMLDivElement>\n  ) => {\n    if (e.button === 1) {\n      closeTab(tabId);\n    }\n  };\n\n  // Restore handleTabClose for close button\n  const handleTabClose = (\n    tabId: string,\n    e: React.MouseEvent<HTMLButtonElement>\n  ) => {\n    e.stopPropagation();\n    closeTab(tabId);\n  };\n\n  if (openTabs.length === 0) {\n    return (\n      <div className=\"h-full flex flex-col items-center justify-center bg-code-bg text-code-text\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"text-6xl\">üìù</div>\n          <h3 className=\"text-lg font-medium\">No files open</h3>\n          <p className=\"text-sm\">\n            Click on files in the File Explorer to open them here\n          </p>\n          <p className=\"text-xs text-code-text\">\n            Try clicking on \"page.tsx\" in the file tree!\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-user-bg min-h-0\">\n      {/* Tabs Header */}\n      <div className=\"border-b bg-user-bg\">\n        <ScrollArea>\n          <div className=\"flex\">\n            {openTabs.map((tab) => (\n              <div\n                key={tab.id}\n                className={`flex items-center gap-2 px-4 py-3 border-r cursor-pointer hover:bg-muted/50 min-w-0 ${\n                  activeTabId === tab.id ? \"bg-user-bg\" : \"bg-user-bg\"\n                }`}\n                onClick={() => setActiveTab(tab.id)}\n                onMouseDown={(e) => handleTabMouseDown(tab.id, e)}\n                tabIndex={0}\n                aria-label={`Open ${tab.name}`}\n                title={tab.name}\n              >\n                <span className=\"text-sm truncate max-w-32\" title={tab.name}>\n                  {tab.name}\n                </span>\n                {tab.isDirty ? (\n                  <div\n                    className=\"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0\"\n                    title=\"Unsaved changes\"\n                  />\n                ) : (\n                  <div\n                    className=\"w-2 h-2 bg-green-500 rounded-full flex-shrink-0\"\n                    title=\"Saved\"\n                  />\n                )}\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-4 w-4 p-0 hover:bg-muted\"\n                  onClick={(e) => handleTabClose(tab.id, e)}\n                  aria-label={`Close ${tab.name}`}\n                >\n                  <X className=\"h-3 w-3\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n        </ScrollArea>\n      </div>\n\n      {/* Editor Controls */}\n      <div className=\"flex items-center justify-between p-2 border-b bg-blue-950\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-sm text-slate-300\">{activeTab?.path}</span>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-8\"\n            onClick={handleSave}\n            disabled={!activeTab?.isDirty}\n            aria-label=\"Save file\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            Save\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-8\"\n            onClick={handleCopy}\n            aria-label=\"Copy code\"\n          >\n            <Copy className=\"h-4 w-4 mr-2\" />\n            Copy\n          </Button>\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                <MoreHorizontal className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem>Format Document</DropdownMenuItem>\n              <DropdownMenuItem>Find & Replace</DropdownMenuItem>\n              <DropdownMenuItem>Go to Line</DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n\n      {/* Monaco Editor */}\n      <div className=\"flex-1 min-h-0 overflow-hidden\">\n        {activeTab && (\n          <Editor\n            height=\"100%\"\n            width=\"100%\"\n            language={activeTab.language}\n            value={activeTab.content}\n            onChange={handleEditorChange}\n            theme={\"vs\"}\n            options={{\n              minimap: { enabled: false },\n              fontSize: 14,\n              lineNumbers: \"on\",\n              roundedSelection: false,\n              scrollBeyondLastLine: false,\n              automaticLayout: true,\n              tabSize: 2,\n              insertSpaces: true,\n              wordWrap: \"on\",\n              contextmenu: true,\n              selectOnLineNumbers: true,\n              glyphMargin: false,\n              folding: true,\n              lineDecorationsWidth: 10,\n              lineNumbersMinChars: 3,\n              renderLineHighlight: \"all\",\n            }}\n            onMount={handleEditorDidMount}\n            loading={<Spinner size={32} />}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}